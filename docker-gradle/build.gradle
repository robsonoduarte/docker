apply plugin: 'java'
apply plugin: 'scala'
apply plugin: 'eclipse'
apply plugin: 'docker'



sourceSets.main.scala.srcDir "src/main/java"
sourceSets.test.scala.srcDir "src/test/java"
sourceSets.main.java.srcDirs = []
sourceSets.test.java.srcDirs = []


buildscript {
    repositories { mavenLocal(); jcenter() }
    dependencies {
        classpath 'se.transmode.gradle:gradle-docker:1.2'
    }
}


repositories {
    jcenter()
}

dependencies {
	compile 'org.scala-lang:scala-library:2.11.8'
	testCompile 'junit:junit:4.12'
}

jar {
    manifest {
        attributes 'Main-Class': 'br.com.mystudies.docker.gradle.Echo'
    }

     from {
    	configurations.compile.collect { it.isDirectory() ? it : zipTree(it) }
  	}
}


docker {
    baseImage 'java:8-jre-alpine'
}



task dockerImage(type: Docker, dependsOn: ['jar', 'startFile']) {


	runCommand 'apk add --update bash && rm -rf /var/cache/apk/*'
	addFile jar.archivePath, '/' + jar.archiveName
	addFile 'build/start.sh', '/start.sh'
	runCommand 'chmod +x /start.sh'
	defaultCommand = ['/start.sh' ]
}




task startFile(){
    copy{
	   from ('src/main/resources'){
			include '**/*.sh'
			filter{
        		String line -> line.replaceAll('#archiveName', jar.archiveName)
    		}
		}
	   into 'build/'
	}
}

